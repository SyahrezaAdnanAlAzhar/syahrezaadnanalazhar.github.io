---
interface Props {
  title: string;
  detailLink?: string;
  showDetailButton?: boolean;
  class?: string;
}

const { 
  title, 
  detailLink, 
  showDetailButton = true,
  class: className = ''
} = Astro.props;

// Get base URL for proper routing
const base = import.meta.env.BASE_URL;
const fullDetailLink = detailLink ? `${base}${detailLink}` : undefined;
---

<div class={`section-heading-container flex flex-row items-center justify-between gap-4 mb-8 md:mb-12 ml-4 sm:ml-8 lg:ml-16 mr-4 sm:mr-8 lg:mr-16 ${className}`}>
  <h2 class="font-heading text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-black">
    {title}
  </h2>
  
  {showDetailButton && fullDetailLink && (
    <a
      href={fullDetailLink}
      class="btn-secondary inline-flex items-center gap-1 sm:gap-2 px-3 py-1.5 sm:px-4 sm:py-2 text-xs sm:text-sm whitespace-nowrap shrink-0"
    >
      <span class="hidden xs:inline">See Detail</span>
      <span class="xs:hidden">Detail</span>
      <svg 
        class="w-3 h-3 sm:w-4 sm:h-4 transition-transform duration-300 group-hover:translate-x-1" 
        fill="none" 
        stroke="currentColor" 
        viewBox="0 0 24 24"
      >
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    </a>
  )}
</div>

<script>
  import gsap from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  let sectionHeadingCleanup = () => {};

  function initSectionHeadingAnimations() {
    sectionHeadingCleanup();

    const headings = document.querySelectorAll('.section-heading-container');
    const mm = gsap.matchMedia();

    headings.forEach((heading) => {
      // Desktop animations (â‰¥1024px)
      mm.add("(min-width: 1024px)", () => {
        gsap.from(heading, {
          scrollTrigger: {
            trigger: heading,
            start: 'top 80%',
            toggleActions: 'play none none reverse'
          },
          x: -50,
          opacity: 0,
          duration: 0.8,
          ease: 'power3.out'
        });
      });

      // Tablet animations (768px-1023px)
      mm.add("(min-width: 768px) and (max-width: 1023px)", () => {
        gsap.from(heading, {
          scrollTrigger: {
            trigger: heading,
            start: 'top 85%',
            toggleActions: 'play none none none'
          },
          opacity: 0,
          y: 20,
          duration: 0.6,
          ease: 'power2.out'
        });
      });

      // Mobile animations (<768px) - Minimal
      mm.add("(max-width: 767px)", () => {
        gsap.from(heading, {
          scrollTrigger: {
            trigger: heading,
            start: 'top 90%',
            toggleActions: 'play none none none'
          },
          opacity: 0,
          duration: 0.4
        });
      });
    });

    sectionHeadingCleanup = () => {
      mm.revert();
    };
  }

  // Initialize on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSectionHeadingAnimations);
  } else {
    initSectionHeadingAnimations();
  }

  // Re-initialize on Astro navigation
  document.addEventListener('astro:page-load', initSectionHeadingAnimations);
</script>
